<?xml version="1.0" encoding="ISO-8859-1" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:c="http://java.sun.com/jsp/jstl/core"
    xmlns:p="http://primefaces.org/ui"
    xmlns:t="http://myfaces.apache.org/tomahawk"
    template="/pages/template/template_padrao.xhtml">
	
	<ui:define name="conteudo">
		<div id="container">
			<h1>Cadastro de Issue</h1>

			<t:saveState value="#{issueAjaxBean.issues}" />
			<t:saveState value="#{issueAjaxBean.issue}" />
			<t:saveState value="#{issueAjaxBean.state}" />
			
			<t:saveState value="#{issueAjaxBean.projetos}" />
			<t:saveState value="#{issueAjaxBean.usuarios}" />
			
			<h:form id="form" prependId="false" binding="#{issueAjaxBean.form}">
			
				<t:div id="blocoDePesquisa" rendered="#{issueAjaxBean.pesquisando}">
					<div align="right">
						<p:commandLink value="Novo" action="#{issueAjaxBean.preparaParaAdicionar}" 
							update="@form" process="@form">
						</p:commandLink> &#160;
						<p:commandButton value="Listar" action="#{issueAjaxBean.lista}" update="tabela_de_issues">
						</p:commandButton>
					</div>
					<t:div id="_tbl">
						<h:dataTable
							id="tabela_de_issues"
							value="#{issueAjaxBean.issues}"
							var="issue"
							rowClasses="odd, even">
							<h:column>
								<f:facet name="header">
									<h:outputText value="Id"/>
								</f:facet>
								<h:outputText value="#{issue.id}"/>
							</h:column>
							<h:column>
								<f:facet name="header">
									<h:outputText value="Sumário"/>
								</f:facet>
								<h:outputText value="#{issue.sumario}"/>
							</h:column>
							<h:column>
								<f:facet name="header">
									<h:outputText value="Projeto"/>
								</f:facet>
								<h:outputText value="#{issue.projeto.nome}"/>
							</h:column>
							<h:column>
								<f:facet name="header">
									<h:outputText value="Tipo"/>
								</f:facet>
								<h:outputText value="#{issue.tipo}"/>
							</h:column>
							<h:column>
								<f:facet name="header">
									<h:outputText value="Status"/>
								</f:facet>
								<h:outputText value="#{issue.status}"/>
							</h:column>
							<h:column>
								<f:facet name="header">
									<h:outputText value="Ultima atualização"/>
								</f:facet>
								<h:outputText value="#{issue.atualizadoEm}">
									<f:convertDateTime pattern="dd/MM/yyyy HH:mm" />
								</h:outputText>
							</h:column>
							<h:column>
								<f:facet name="header">
									<h:outputText value="Assinado para"/>
								</f:facet>
								<h:outputText value="#{issue.assinadoPara.nome}"/>
							</h:column>
							<h:column>
								<f:facet name="header">
									<h:outputText value="Ações"/>
								</f:facet>
								<h:commandLink value="editar" action="#{issueAjaxBean.preparaParaAlterar(issue)}">
									<f:ajax render="@form" execute="@form"/>
								</h:commandLink> &#160;
								<h:commandLink value="remover" action="#{issueAjaxBean.remove}"
									onclick="return confirm('Deseja realmente remover este issue?');">
									<f:ajax render=":form:tabela_de_issues" />
									<f:setPropertyActionListener value="#{issue}" target="#{issueAjaxBean.issue}"/>
								</h:commandLink>
							</h:column>
						</h:dataTable>
					</t:div>
				</t:div>
				<t:div id="blocoDeEdicao" rendered="#{!issueAjaxBean.pesquisando}">
					<div align="left">
					
						<h:outputLabel value="Sumário" for="sumario" />
						<p:inputText value="#{issueAjaxBean.issue.sumario}"
							required="true" id="sumario" label="Sumário">
							<f:validateLength minimum="3" />
						</p:inputText>
						
						<h:outputLabel value="Descrição" for="descricao"/>
						<p:inputTextarea rows="6" value="#{issueAjaxBean.issue.descricao}"
							required="true" id="descricao" label="Descrição"/>
							
						<h:outputLabel value="Projeto" for="projeto"/>
						<p:selectOneMenu value="#{issueAjaxBean.issue.projeto}" 
							id="projeto" label="Projeto"
							required="true">
							<f:selectItem itemLabel="Selecione um projeto" noSelectionOption="true" />
							<f:selectItems value="#{issueAjaxBean.projetos}" var="o"
	   								itemLabel="#{o.nome}" itemValue="#{o}" />
						</p:selectOneMenu>
						
						<h:outputLabel value="Tipo" for="tipo"/>
						<p:selectOneRadio value="#{issueAjaxBean.issue.tipo}" 
							id="tipo" layout="pageDirection" required="true" label="Tipo" 
							disabled="#{issueAjaxBean.editando}">
							<f:selectItem itemLabel="Bug" itemValue="BUG" />
							<f:selectItem itemLabel="Feature" itemValue="FEATURE" />
						</p:selectOneRadio>
						
						<h:outputLabel value="Reportado em" for="reportadoEm" />
						<p:inputText value="#{issueAjaxBean.issue.reportadoEm}"
							required="true" id="reportadoEm" label="Reportado em" disabled="#{issueAjaxBean.editando}">
							<f:convertDateTime pattern="dd/MM/yyyy HH:mm" />
						</p:inputText>
						
						<h:outputLabel value="Reportado por" for="reportadoPor" />
						<p:inputText value="#{issueAjaxBean.issue.reportadoPor.nome}"
							required="true" id="reportadoPor" label="Reportado por" disabled="true">
						</p:inputText>
						
						<h:outputLabel value="Assinado para" for="assinadoPara"/>
						<p:selectOneMenu value="#{issueAjaxBean.issue.assinadoPara}" 
							id="assinadoPara" label="Assinado para"
							required="true" >
							<f:selectItem itemLabel="Selecione um usuário" noSelectionOption="true" />
							<f:selectItems value="#{issueAjaxBean.usuarios}" var="o"
	   								itemLabel="#{o.nome}" itemValue="#{o}" />
						</p:selectOneMenu>
						
						<div align="right">
							<p:commandLink value="voltar" immediate="true" action="#{issueAjaxBean.volta}">
								<f:ajax render="@form" execute="@form"/>
							</p:commandLink>  &#160;
							<p:commandButton value="inserir" action="#{issueAjaxBean.adiciona}"
								rendered="#{issueAjaxBean.adicionando}"
								update="@form" process="@form">
							</p:commandButton>
							<p:commandButton value="alterar" action="#{issueAjaxBean.altera}" 
								rendered="#{issueAjaxBean.editando}">
								<f:ajax render="@form" execute="@form"/>
							</p:commandButton>
						</div>
					</div>
				</t:div>
			</h:form>
		</div>
	</ui:define>
	
</ui:composition>